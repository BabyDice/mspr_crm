<!-- commandes.html -->
<!DOCTYPE html>
<html>
<head>
    <!-- Ajoutez vos balises head ici -->
</head>
<body>
<h2>Liste des Commandes</h2>

<table border="1" id="commandesTable">
    <tr>
        <th>Client</th>
        <th>Produit</th>
        <th>Date Commande</th>
    </tr>
    <!-- Les commandes seront ajoutées dynamiquement avec JavaScript -->
</table>

<h2>Ajouter une Commande</h2>

<form onsubmit="addCommande(); return false;">
    <label for="clientSelect">Client :</label>
    <select id="clientSelect">
        <!-- Options seront ajoutées dynamiquement avec JavaScript -->
    </select>

    <label for="productSelect">Produit :</label>
    <select id="productSelect">
        <!-- Options seront ajoutées dynamiquement avec JavaScript -->
    </select>

    <label for="dateCommandeInput">Date de Commande :</label>
    <input type="date" id="dateCommandeInput" required>

    <button type="submit" class="btn btn-primary">Ajouter la Commande</button>
</form>

<script>
    function fillSelectOptions(data, selectId) {
        const select = document.getElementById(selectId);

        console.log("Filling options for select with ID:", selectId);

        data.forEach(item => {
            console.log("Adding option:", item);
            const option = document.createElement("option");
            option.value = item.id;
            option.text = item.name;
            select.add(option);
        });
    }


    function addCommande() {
        // Récupérez les valeurs sélectionnées dans les sélecteurs
        const clientId = document.getElementById("clientSelect").value;
        const productId = document.getElementById("productSelect").value;
        const dateCommande = document.getElementById("dateCommandeInput").value;

        // Construisez l'objet avec les données
        const commandeData = {
            client: { id: parseInt(clientId) },
            product: { id: parseInt(productId) },
            dateCommande: dateCommande,
            // Ajoutez d'autres propriétés selon vos besoins
        };

        // Effectuez une requête vers votre backend pour ajouter la commande
        fetch("/add", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(commandeData),
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(data => {
                // Réponse du backend après l'ajout réussi
                console.log("Réponse du serveur :", data);
                // Mise à jour de la table des commandes
                displayCommandes(data);
                // Effacez les valeurs dans les champs après l'ajout
                document.getElementById("clientSelect").value = "";
                document.getElementById("productSelect").value = "";
                document.getElementById("dateCommandeInput").value = "";
            })
            .catch(error => {
                console.error("Erreur lors de la requête POST:", error);
                alert("Erreur lors de l'ajout de la commande. Veuillez vérifier la console pour plus de détails.");
            });
    }


    // Récupérez les clients et les produits depuis votre backend
    // ...

    // Récupérez les clients depuis votre backend
    fetch("/clients")
        .then(response => response.json())
        .then(data => {
            console.log("Clients data:", data);
            fillSelectOptions(data, "clientSelect");
        })
        .catch(error => {
            console.error("Erreur lors de la récupération des clients:", error);
            alert("Erreur lors de la récupération des clients. Veuillez vérifier la console pour plus de détails.");
        });

    // Récupérez les produits depuis votre backend
    fetch("/products")
        .then(response => response.json())
        .then(data => {
            console.log("Products data:", data);
            fillSelectOptions(data, "productSelect");
        })
        .catch(error => {
            console.error("Erreur lors de la récupération des produits:", error);
            alert("Erreur lors de la récupération des produits. Veuillez vérifier la console pour plus de détails.");
        });
    fetch("/getAllCommandes")
        .then(response => response.json())
        .then(data => {
            console.log("Commandes data:", data);
            // Logique pour afficher les commandes dans votre table
            displayCommandes(data);
        })
        .catch(error => {
            console.error("Erreur lors de la récupération des commandes:", error);
            alert("Erreur lors de la récupération des commandes. Veuillez vérifier la console pour plus de détails.");
        });


    // Fonction pour afficher les commandes dans la table
    function displayCommandes(commandes) {
        // Supprimez le contenu actuel de la table
        const commandesTable = document.getElementById("commandesTable");
        commandesTable.innerHTML = "";

        // Parcourez les nouvelles commandes et ajoutez-les à la table
        commandes.forEach(commande => {
            const newRow = commandesTable.insertRow(-1);

            // Ajoutez les cellules avec les données de la commande
            const clientCell = newRow.insertCell(0);
            clientCell.textContent = commande.client ? commande.client.name : "N/A";

            const productCell = newRow.insertCell(1);
            productCell.textContent = commande.product ? commande.product.name : "N/A";

            const dateCommandeCell = newRow.insertCell(2);
            dateCommandeCell.textContent = commande.dateCommande;
        });
    }

    // ...
</script>
</body>
</html>
